


FROM debian:bookworm

# Package installation
RUN apt update -y
RUN apt install -y \
attr \
autoconf \
autoconf-archive \
automake \
autopoint \
bison \
btrfs-progs \
ccache \
cpio \
cryptsetup \
dosfstools \
e2fsprogs \
erofs-utils \
exfat-fuse \
exfatprogs \
f2fs-tools \
flex \
fonts-dejavu-core \
g++ \
gawk \
gcc-aarch64-linux-gnu \
gcc-arm-linux-gnueabihf \
gcc-mips-linux-gnu \
gcc-mipsel-linux-gnu \
gcc-powerpc64-linux-gnu \
gcc-riscv64-linux-gnu \
gcc-sparc64-linux-gnu \
genromfs \
gettext \
git \
gzip \
jfsutils \
kmod \
libdevmapper-dev \
libfreetype6-dev \
libfuse3-dev \
liblzma-dev \
libpciaccess-dev \
libsdl1.2-dev \
libtasn1-6-dev \
locales \
lzop \
make \
mingw-w64 \
mingw-w64-tools \
mtools \
multitee \
nilfs-tools \
ntfs-3g \
ovmf \
parted \
patch \
pkg-config \
python3 \
qemu-system \
qemu-system-data \
recode \
reiserfsprogs \
rsync \
squashfs-tools \
strace \
swtpm \
tar \
texinfo \
texlive \
tpm2-tools \
udftools \
unifont \
util-linux \
wamerican \
wget \
xfsprogs \
xorriso \
xz-utils \
zfs-fuse

# Extra cross-compiler download & untar
ENV CROSS_C=/usr/local/lib/gcc-13.2.0-nolibc
RUN mkdir -p /usr/local/lib && \
    cd /usr/local/lib && \
    wget -q https://mirrors.kernel.org/pub/tools/crosstool/files/bin/x86_64/13.2.0/x86_64-gcc-13.2.0-nolibc-ia64-linux.tar.gz && \
    wget -q https://mirrors.kernel.org/pub/tools/crosstool/files/bin/x86_64/13.2.0/x86_64-gcc-13.2.0-nolibc-loongarch64-linux.tar.gz && \
    wget -q https://mirrors.kernel.org/pub/tools/crosstool/files/bin/x86_64/13.2.0/x86_64-gcc-13.2.0-nolibc-riscv32-linux.tar.gz && \
    for f in *.tar.gz; do tar -xzf "$f"; done

# Clone GRUB, not required for CI but perhaps useful for local testing
RUN git clone --depth 1 https://git.savannah.gnu.org/git/grub.git /grub

# CI serial build script
COPY grub-test-build .
RUN chmod +x grub-test-build
